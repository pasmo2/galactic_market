<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL"
                  xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
                  xmlns:dc="http://www.omg.org/spec/DD/20100524/DC"
                  xmlns:di="http://www.omg.org/spec/DD/20100524/DI"
                  xmlns:camunda="http://camunda.org/schema/1.0/bpmn"
                  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                  id="Definitions_1"
                  targetNamespace="http://bpmn.io/schema/bpmn">

  <bpmn:process id="galactic_market_demand" name="Galaktický Trh - Proces Dopytu" isExecutable="true" camunda:historyTimeToLive="30">
    <bpmn:startEvent id="StartEvent_CreateDemand" name="vytvorenie dopytu na kúpu objektu">
      <bpmn:outgoing>Flow_CheckAvailability</bpmn:outgoing>
    </bpmn:startEvent>

    <bpmn:scriptTask id="ServiceTask_CheckAvailability" name="kontrola dostupnosti objektu" scriptFormat="groovy">
      <bpmn:incoming>Flow_CheckAvailability</bpmn:incoming>
      <bpmn:outgoing>Flow_Gateway_Available</bpmn:outgoing>
      <bpmn:script>execution.setVariable('isAvailable', true)</bpmn:script>
    </bpmn:scriptTask>

    <bpmn:exclusiveGateway id="Gateway_Available" name="je objekt dostupný?">
      <bpmn:incoming>Flow_Gateway_Available</bpmn:incoming>
      <bpmn:outgoing>Flow_Available_Yes</bpmn:outgoing>
      <bpmn:outgoing>Flow_Available_No</bpmn:outgoing>
    </bpmn:exclusiveGateway>

    <bpmn:scriptTask id="ServiceTask_CreateDemand" name="vytvorenie dopytu" scriptFormat="groovy">
      <bpmn:incoming>Flow_Available_Yes</bpmn:incoming>
      <bpmn:outgoing>Flow_UserTask_Decision</bpmn:outgoing>
      <bpmn:script>execution.setVariable('ownerId', 'test_owner')</bpmn:script>
    </bpmn:scriptTask>

    <bpmn:userTask id="UserTask_OwnerDecision" name="rozhodnutie vlastníka objektu" camunda:assignee="${ownerId}">
      <bpmn:incoming>Flow_UserTask_Decision</bpmn:incoming>
      <bpmn:outgoing>Flow_Gateway_OfferAccepted</bpmn:outgoing>
    </bpmn:userTask>

    <bpmn:exclusiveGateway id="Gateway_OfferAccepted" name="prijatá ponuka?">
      <bpmn:incoming>Flow_Gateway_OfferAccepted</bpmn:incoming>
      <bpmn:outgoing>Flow_OfferAccepted_Yes</bpmn:outgoing>
      <bpmn:outgoing>Flow_OfferAccepted_No</bpmn:outgoing>
    </bpmn:exclusiveGateway>

    <bpmn:scriptTask id="ServiceTask_ConfirmDemand" name="potvrdenie dopytu" scriptFormat="groovy">
      <bpmn:incoming>Flow_OfferAccepted_Yes</bpmn:incoming>
      <bpmn:outgoing>Flow_SellObject</bpmn:outgoing>
      <bpmn:script/>
    </bpmn:scriptTask>

    <bpmn:scriptTask id="ServiceTask_SellObject" name="predaj objektu" scriptFormat="groovy">
      <bpmn:incoming>Flow_SellObject</bpmn:incoming>
      <bpmn:outgoing>Flow_End_Success</bpmn:outgoing>
      <bpmn:script/>
    </bpmn:scriptTask>

    <bpmn:scriptTask id="ServiceTask_CancelDemand" name="zrušenie dopytu" scriptFormat="groovy">
      <bpmn:incoming>Flow_Available_No</bpmn:incoming>
      <bpmn:incoming>Flow_OfferAccepted_No</bpmn:incoming>
      <bpmn:outgoing>Flow_End_Cancel</bpmn:outgoing>
      <bpmn:script/>
    </bpmn:scriptTask>

    <bpmn:endEvent id="EndEvent_Success" name="koniec procesu">
      <bpmn:incoming>Flow_End_Success</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:endEvent id="EndEvent_Cancel" name="koniec procesu">
      <bpmn:incoming>Flow_End_Cancel</bpmn:incoming>
    </bpmn:endEvent>

    <!-- Sequence Flows -->
    <bpmn:sequenceFlow id="Flow_CheckAvailability" sourceRef="StartEvent_CreateDemand" targetRef="ServiceTask_CheckAvailability"/>
    <bpmn:sequenceFlow id="Flow_Gateway_Available" sourceRef="ServiceTask_CheckAvailability" targetRef="Gateway_Available"/>
    <bpmn:sequenceFlow id="Flow_Available_Yes" sourceRef="Gateway_Available" targetRef="ServiceTask_CreateDemand" name="áno">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${isAvailable}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_Available_No" sourceRef="Gateway_Available" targetRef="ServiceTask_CancelDemand" name="nie">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${!isAvailable}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_UserTask_Decision" sourceRef="ServiceTask_CreateDemand" targetRef="UserTask_OwnerDecision"/>
    <bpmn:sequenceFlow id="Flow_Gateway_OfferAccepted" sourceRef="UserTask_OwnerDecision" targetRef="Gateway_OfferAccepted"/>
    <bpmn:sequenceFlow id="Flow_OfferAccepted_Yes" sourceRef="Gateway_OfferAccepted" targetRef="ServiceTask_ConfirmDemand" name="áno">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${offerAccepted}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_OfferAccepted_No" sourceRef="Gateway_OfferAccepted" targetRef="ServiceTask_CancelDemand" name="nie">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${!offerAccepted}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_SellObject" sourceRef="ServiceTask_ConfirmDemand" targetRef="ServiceTask_SellObject"/>
    <bpmn:sequenceFlow id="Flow_End_Success" sourceRef="ServiceTask_SellObject" targetRef="EndEvent_Success"/>
    <bpmn:sequenceFlow id="Flow_End_Cancel" sourceRef="ServiceTask_CancelDemand" targetRef="EndEvent_Cancel"/>
  </bpmn:process>

  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="galactic_market_demand">
      <bpmndi:BPMNShape id="StartEvent_CreateDemand_di" bpmnElement="StartEvent_CreateDemand">
        <dc:Bounds x="100" y="100" width="36" height="36"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ServiceTask_CheckAvailability_di" bpmnElement="ServiceTask_CheckAvailability">
        <dc:Bounds x="200" y="90" width="100" height="80"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_Available_di" bpmnElement="Gateway_Available">
        <dc:Bounds x="350" y="105" width="50" height="50"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ServiceTask_CreateDemand_di" bpmnElement="ServiceTask_CreateDemand">
        <dc:Bounds x="450" y="90" width="100" height="80"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="UserTask_OwnerDecision_di" bpmnElement="UserTask_OwnerDecision">
        <dc:Bounds x="600" y="90" width="100" height="80"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_OfferAccepted_di" bpmnElement="Gateway_OfferAccepted">
        <dc:Bounds x="750" y="105" width="50" height="50"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ServiceTask_ConfirmDemand_di" bpmnElement="ServiceTask_ConfirmDemand">
        <dc:Bounds x="850" y="90" width="100" height="80"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ServiceTask_SellObject_di" bpmnElement="ServiceTask_SellObject">
        <dc:Bounds x="1000" y="90" width="100" height="80"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_Success_di" bpmnElement="EndEvent_Success">
        <dc:Bounds x="1150" y="110" width="36" height="36"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ServiceTask_CancelDemand_di" bpmnElement="ServiceTask_CancelDemand">
        <dc:Bounds x="600" y="250" width="100" height="80"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_Cancel_di" bpmnElement="EndEvent_Cancel">
        <dc:Bounds x="750" y="270" width="36" height="36"/>
      </bpmndi:BPMNShape>
      <!-- Edges (lines between elements) -->
      <bpmndi:BPMNEdge id="Flow_CheckAvailability_di" bpmnElement="Flow_CheckAvailability">
        <di:waypoint x="136" y="118"/>
        <di:waypoint x="200" y="130"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Gateway_Available_di" bpmnElement="Flow_Gateway_Available">
        <di:waypoint x="300" y="130"/>
        <di:waypoint x="350" y="130"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Available_Yes_di" bpmnElement="Flow_Available_Yes">
        <di:waypoint x="400" y="130"/>
        <di:waypoint x="450" y="130"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Available_No_di" bpmnElement="Flow_Available_No">
        <di:waypoint x="375" y="155"/>
        <di:waypoint x="650" y="290"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_UserTask_Decision_di" bpmnElement="Flow_UserTask_Decision">
        <di:waypoint x="550" y="130"/>
        <di:waypoint x="600" y="130"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Gateway_OfferAccepted_di" bpmnElement="Flow_Gateway_OfferAccepted">
        <di:waypoint x="700" y="130"/>
        <di:waypoint x="750" y="130"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_OfferAccepted_Yes_di" bpmnElement="Flow_OfferAccepted_Yes">
        <di:waypoint x="800" y="130"/>
        <di:waypoint x="850" y="130"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_OfferAccepted_No_di" bpmnElement="Flow_OfferAccepted_No">
        <di:waypoint x="775" y="155"/>
        <di:waypoint x="650" y="290"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_SellObject_di" bpmnElement="Flow_SellObject">
        <di:waypoint x="950" y="130"/>
        <di:waypoint x="1000" y="130"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_End_Success_di" bpmnElement="Flow_End_Success">
        <di:waypoint x="1100" y="130"/>
        <di:waypoint x="1150" y="128"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_End_Cancel_di" bpmnElement="Flow_End_Cancel">
        <di:waypoint x="700" y="290"/>
        <di:waypoint x="750" y="288"/>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>

</bpmn:definitions> 